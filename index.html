<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Swinging Knives</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <style>
    body { margin:0; background:#000; }
    canvas { display:block; margin:0 auto; }
  </style>
</head>
<body>
<script>
const config = {
  type: Phaser.AUTO,
  width: 960,
  height: 540,
  backgroundColor: "#0b0b0f",
  physics: {
    default: "arcade",
    arcade: { gravity: { y: 1100 }, debug: false }
  },
  scene: { preload, create, update }
};

new Phaser.Game(config);

let player, ground, finish, cursors;
let knives = [];
let spawn = { x: 80, y: 390 };
let canHit = true;

function sayOhYeah() {
  try {
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance("Oh yeah!");
    u.rate = 1.0; u.pitch = 0.9; u.volume = 1.0;
    speechSynthesis.speak(u);
  } catch(e){}
}

function preload(){}

function create() {
  cursors = this.input.keyboard.createCursorKeys();

  // --- Generate textures (draw lifelike-ish shapes) ---
  generateKnifeTexture(this);
  generatePersonTexture(this);

  // Subtle stars / noise background vibe
  const bg = this.add.graphics();
  for (let i=0;i<140;i++){
    const x = Phaser.Math.Between(0, config.width);
    const y = Phaser.Math.Between(0, config.height);
    const a = Phaser.Math.FloatBetween(0.1, 0.6);
    bg.fillStyle(0xffffff, a);
    bg.fillCircle(x, y, Phaser.Math.Between(1,2));
  }

  // Ground
  ground = this.add.rectangle(480, 505, 960, 70, 0x1e1e28);
  this.physics.add.existing(ground, true);

  // Finish line
  finish = this.add.rectangle(920, 330, 18, 240, 0x18ff7b);
  this.physics.add.existing(finish, true);

  // Player (person sprite)
  player = this.physics.add.sprite(spawn.x, spawn.y, "person");
  player.setCollideWorldBounds(true);
  player.body.setSize(22, 44).setOffset(21, 10); // tighter hitbox than the art

  this.physics.add.collider(player, ground);

  // Knives (swingers)
  addSwingKnife(this, 300, 110, 120, 2.1, 55);
  addSwingKnife(this, 520, 110, 160, 1.6, 70);
  addSwingKnife(this, 730, 130, 120, 2.7, 60);

  // Optional low “ground knife” you jump over
  addGroundKnife(this, 610, 470);

  // Overlaps
  knives.forEach(k => this.physics.add.overlap(player, k.body, () => hitPlayer(this)));
  this.physics.add.overlap(player, finish, () => win(this));

  this.add.text(12, 10, "Arrows: move/jump • Avoid knives • Reach green line",
    { fontFamily:"system-ui, Arial", fontSize:"14px", color:"#eaeaea" });

  // store for update
  this.knives = knives;
}

function update(time, deltaMs) {
  const speed = 240;

  // movement
  if (cursors.left.isDown) player.setVelocityX(-speed);
  else if (cursors.right.isDown) player.setVelocityX(speed);
  else player.setVelocityX(0);

  // jump
  if (cursors.up.isDown && player.body.blocked.down) player.setVelocityY(-540);

  // tiny run “bob” animation
  if (Math.abs(player.body.velocity.x) > 10 && player.body.blocked.down) {
    player.setScale(1, 1 + Math.sin(time / 60) * 0.02);
  } else {
    player.setScale(1, 1);
  }

  // update swinging knives
  for (const k of this.knives) {
    if (!k.swing) continue;
    k.t += deltaMs / 1000;

    const ang = Math.sin(k.t * k.speed) * Phaser.Math.DegToRad(k.angleDeg);
    const x = k.px + Math.sin(ang) * k.len;
    const y = k.py + Math.cos(ang) * k.len;

    // chain line
    k.chain.setTo(k.px, k.py, x, y);
    k.chainGfx.clear();
    k.chainGfx.lineStyle(2, 0x8f8f9a, 0.9);
    k.chainGfx.strokeLineShape(k.chain);

    // move knife
    k.body.setPosition(x, y);
    k.body.setRotation(ang); // rotate knife with swing
  }
}

function hitPlayer(scene) {
  if (!canHit) return;
  canHit = false;

  sayOhYeah();
  scene.cameras.main.shake(120, 0.01);

  scene.time.delayedCall(220, () => {
    player.body.reset(spawn.x, spawn.y);
    player.setVelocity(0,0);
    canHit = true;
  });
}

function win(scene) {
  scene.physics.pause();
  scene.add.rectangle(480, 250, 520, 170, 0x000000, 0.7);
  scene.add.text(480, 235, "YOU WIN", { fontFamily:"system-ui, Arial", fontSize:"46px", color:"#ffffff" }).setOrigin(0.5);
  scene.add.text(480, 290, "Refresh to play again", { fontFamily:"system-ui, Arial", fontSize:"16px", color:"#dddddd" }).setOrigin(0.5);
}

// --- Knife + Person textures (drawn in code) ---
function generateKnifeTexture(scene) {
  const g = scene.make.graphics({ x:0, y:0, add:false });

  // Canvas for knife texture
  const w = 90, h = 26;
  g.clear();

  // Handle
  g.fillStyle(0x2d2d2d, 1);
  g.fillRoundedRect(4, 8, 20, 10, 4);

  // Guard
  g.fillStyle(0x8a6f3d, 1);
  g.fillRoundedRect(22, 6, 6, 14, 3);

  // Blade (polygon)
  g.fillStyle(0xd7dbe2, 1);
  g.beginPath();
  g.moveTo(28, 6);
  g.lineTo(84, 13);
  g.lineTo(28, 20);
  g.closePath();
  g.fillPath();

  // Blade edge highlight
  g.lineStyle(2, 0xffffff, 0.35);
  g.beginPath();
  g.moveTo(30, 7);
  g.lineTo(82, 13);
  g.lineTo(30, 19);
  g.strokePath();

  g.generateTexture("knife", w, h);
  g.destroy();
}

function generatePersonTexture(scene) {
  const g = scene.make.graphics({ x:0, y:0, add:false });

  const w = 64, h = 64;
  g.clear();

  // Head
  g.fillStyle(0xf1c27d, 1);
  g.fillCircle(32, 14, 9);

  // Body (shirt)
  g.fillStyle(0x3ea1ff, 1);
  g.fillRoundedRect(24, 24, 16, 20, 6);

  // Arms
  g.fillStyle(0xf1c27d, 1);
  g.fillRoundedRect(18, 26, 8, 10, 4);
  g.fillRoundedRect(38, 26, 8, 10, 4);

  // Legs
  g.fillStyle(0x1e1e1e, 1);
  g.fillRoundedRect(25, 44, 8, 16, 3);
  g.fillRoundedRect(31, 44, 8, 16, 3);

  // Shoes
  g.fillStyle(0xffffff, 1);
  g.fillRoundedRect(23, 57, 12, 6, 3);
  g.fillRoundedRect(29, 57, 12, 6, 3);

  g.generateTexture("person", w, h);
  g.destroy();
}

// --- Knife spawners ---
function addSwingKnife(scene, pivotX, pivotY, length, speed, angleDeg) {
  const knifeSprite = scene.physics.add.sprite(pivotX, pivotY + length, "knife");
  knifeSprite.body.setAllowGravity(false);
  knifeSprite.body.setImmovable(true);
  knifeSprite.setOrigin(0.2, 0.5);
  knifeSprite.setScale(0.95);

  const chainGfx = scene.add.graphics();
  const chain = new Phaser.Geom.Line(pivotX, pivotY, pivotX, pivotY + length);

  knives.push({
    swing: true,
    body: knifeSprite,
    px: pivotX,
    py: pivotY,
    len: length,
    speed,
    angleDeg,
    t: Math.random() * 10,
    chainGfx,
    chain
  });
}

function addGroundKnife(scene, x, y) {
  // A low knife that acts like a jump obstacle (static)
  const k = scene.physics.add.sprite(x, y, "knife");
  k.body.setAllowGravity(false);
  k.body.setImmovable(true);
  k.setAngle(0);
  k.setScale(0.9);
  knives.push({ swing:false, body:k });
}
</script>
</body>
</html>